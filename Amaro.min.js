!function(a,b){"function"==typeof define&&define.amd?define(b):a.Amaro=b()}(this,function(){var a,b,c,d,e,f,g,h,i,j;return a=function(){function a(){this.promise=new Promise(function(a,b){this.resolve=a,this.reject=b}.bind(this))}return a}(),b=function(){var a={};a.noop=Function.prototype;var b=void 0!==document.createElement("div").style.transition;return a.deepCopy=function(b){var c;if(null==b||"object"!=typeof b)return b;if(b instanceof Date)return c=new Date,c.setTime(b.getTime()),c;if(b instanceof Array){c=[];for(var d=0,e=b.length;e>d;d++)c[d]=a.deepCopy(b[d]);return c}if(b instanceof Object){c={};for(var f in b)b.hasOwnProperty(f)&&(c[f]=a.deepCopy(b[f]));return c}throw new Error("Unable to copy input! Its type isn't supported.")},a.getNextSiblings=function(a){for(var b=a,c=[];null!==(b=b.nextSibling);)c.push(b);return c},a.getTotalTransitionTime=function(a){var b,c,d=0,e=getComputedStyle(a),f=e.transitionDuration.split(", "),g=e.transitionDelay.split(", ");for(b=0,c=f.length;c>b;b++)d=Math.max(d,parseFloat(f[b])+parseFloat(g[b]));return d*=1e3},b||(a.getTotalTransitionTime=function(){return 0}),a.forceRedraw=function(a){var b=a.style.display;a.style.display="none",a.offsetWidth,a.style.display=b},a}(),c=function(a,b){function c(){this.enabled=!1,this.prefix="",this.animation=new a}var d=c.prototype;return c.TYPE={APPEAR:"-appear",ENTER:"-enter",LEAVE:"-leave"},d.enable=function(){this.enabled=!0},d.animate=function(c,d){if(!this.enabled)return Promise.resolve();var e,f=this.prefix+d,g=f+"-active",h=function(){c.forEach(function(a){a.classList.remove(f,g)})};return this.animation.reject(),this.animation=new a,this.animation.promise.then(h,h),c.forEach(function(a){a.classList.add(f),b.forceRedraw(a)}),e=Math.max.apply(null,c.map(b.getTotalTransitionTime)),0===e?(this.animation.resolve(),this.animation.promise):(c.forEach(function(a){a.classList.add(g)}),setTimeout(this.animation.resolve,e),this.animation.promise)},c}(a,b),d=function(a){function b(b){this.element=b,this.expression=e,this.children=[],this.parent=null,this.original=this,this.id=d++,this.isMounted=!1,this.animator=new a}var c=b.prototype,d=1,e=function(a){return a};return c.acceptState=function(a,b,c){var d,e;for(d=0,e=this.children.length;e>d;d++)this.children[d].acceptState(a,b,c);this.isMounted=!0},c.addChild=function(a){a.parent=this,this.children.push(a),a.element.setAttribute("data-control-"+this.id+"-"+a.id,"")},c.cloneOn=function(a){var b=this.constructor,c=new b(a);return c.expression=this.expression,void 0!==this.keyExpression&&(c.keyExpression=this.keyExpression),c.original=this.original,c.copyChildrenFrom(this),c},c.addToTree=function(a){var b,c,d,e=this.children;for(c=0,d=e.length;d>c;c++)if(b=e[c],b.element.contains(a.element)||b.element===a.element)return void b.addToTree(a);this.addChild(a)},c.controlDidParse=function(){var a,b;for(a=0,b=this.children.length;b>a;a++)this.children[a].controlDidParse()},c.copyChildrenFrom=function(a){this.children=a.children.map(function(b){var c,d="data-control-"+a.original.id+"-"+b.original.id;c=this.element.hasAttribute(d)?this.element:this.element.querySelector("["+d+"]"),null===c&&(c=this.template.querySelector("["+d+"]"));var e=b.cloneOn(c);return e.parent=this,e},this)},c.enter=function(){var b=this.isMounted?a.TYPE.ENTER:a.TYPE.APPEAR;return this.animator.animate([this.element],b)},c.leave=function(){return this.isMounted?this.animator.animate([this.element],a.TYPE.LEAVE):Promise.resolve()},c.unmount=function(){var a,b;for(a=0,b=this.children.length;b>a;a++)this.children[a].unmount()},b}(c),e=function(a,b){function c(c){a.call(this,c),this.state=b.deepCopy(this.constructor.defaults),this.prevState=b.deepCopy(this.state)}c.prototype=Object.create(a.prototype);var d=c.prototype;return d.constructor=c,c.defaults={},d.acceptState=function(a,b,c){this.setState(this.expression.call(c,a,b),b),this.isMounted=!0},d.setState=function(a,c){var d,e,f=this.prevState,g=Object.assign(this.state,a),h=this.isMounted?this.shouldComponentUpdate(g):!0;if(this.prevState=b.deepCopy(this.state),h!==!1){for(this.isMounted?this.componentWillUpdate(g):this.componentWillMount(),d=0,e=this.children.length;e>d;d++)this.children[d].acceptState(g,c,this);this.isMounted?this.componentDidUpdate(f):this.componentDidMount()}},d.unmount=function(){a.prototype.unmount.call(this),this.componentWillUnmount()},d.componentWillMount=function(){},d.componentDidMount=function(){},d.shouldComponentUpdate=function(a){return!0},d.componentWillUpdate=function(a){},d.componentDidUpdate=function(a){},d.componentWillUnmount=function(){},c}(d,b),f=function(a,b){function c(c){a.call(this,c),this.parentNode=null,this.nextSiblings=b.getNextSiblings(this.element),this.isAttached=!0}c.prototype=Object.create(a.prototype);var d=c.prototype;return d.constructor=c,d.acceptState=function(b,c,d){this.expression.call(d,b,c)?(this.attach(),a.prototype.acceptState.call(this,b,c)):this.detach(),this.isMounted=!0},d.attach=function(){this.isAttached&&this.isMounted||(this.isAttached=!0,document.body.contains(this.element)||this.parentNode.insertBefore(this.element,this.getReferenceNode()),this.enter())},d.getReferenceNode=function(){for(var a,b=-1,c=null;void 0!==(a=this.nextSiblings[++b]);)if(a.parentNode===this.parentNode){c=a;break}return c},d.detach=function(){this.isAttached&&(this.isAttached=!1,this.leave())},d.leave=function(){var b=a.prototype.leave.call(this);return b.then(function(){this.parentNode=this.element.parentNode,this.parentNode.removeChild(this.element)}.bind(this)),b},c}(d,b),g=function(a,b){function c(a){b.call(this,a),this.childNodes=Array.prototype.slice.call(a.childNodes,0),this.index=-1,this.willDestroy=!1}c.prototype=Object.create(b.prototype);var d=c.prototype;return d.constructor=c,d.enter=function(){var b=this.parent.isMounted?a.TYPE.ENTER:a.TYPE.APPEAR;return this.animator.animate(this.childNodes,b)},d.leave=function(){if(!this.isMounted)return Promise.resolve();var b=this.animator.animate(this.childNodes,a.TYPE.LEAVE);return b.then(function(){this.childNodes.forEach(function(a){a.parentNode.removeChild(a)})}.bind(this)),b},c}(c,d),h=function(a,b,c){function d(b){a.call(this,b),this.keyExpression=c.noop,this.template=document.createElement("template"),this.iterations={}}d.prototype=Object.create(a.prototype);var e=d.prototype;return e.constructor=d,e.acceptState=function(a,b,c){var d=this.expression.call(c,a,b),e={};b={key:null,val:null,outer:b},Object.keys(d).forEach(function(f,g){b.key=f,b.val=d[f];var h=this.keyExpression.call(c,a,b),i=this.iterations[h],j=!1;void 0===i&&(i=this.createIteration(),j=!0),delete this.iterations[h],e[h]=i,i.index===g||i.willDestroy||(i.index=g,i.childNodes.forEach(function(a){this.element.appendChild(a)},this),j&&i.enter()),i.acceptState(a,b,c)},this),Object.keys(this.iterations).forEach(function(a){var b=this.iterations[a];b.willDestroy||(e[a]=b,b.willDestroy=!0,b.unmount(),b.leave().then(function(){delete e[a]}))},this),this.iterations=e,this.isMounted=!0},e.copyChildrenFrom=function(b){this.template=b.template,a.prototype.copyChildrenFrom.call(this,b)},e.controlDidParse=function(){a.prototype.controlDidParse.call(this);var b,c,d=Array.prototype.slice.call(this.element.children);for(b=0,c=d.length;c>b;b++)this.template.appendChild(d[b])},e.createIteration=function(){var a=this.template.cloneNode(!0),c=new b(a);return c.parent=this,c.animator.enabled=this.animator.enabled,c.animator.prefix=this.animator.prefix,c.copyChildrenFrom(this),c},d}(d,g,b),i=function(a){function b(b){a.call(this,b)}b.prototype=Object.create(a.prototype);var c=b.prototype;return c.constructor=b,b.merge=function(a,c){var d,e,f;for(d in c)if(c.hasOwnProperty(d)){if(f=c[d],"object"==typeof f){b.merge(a[d],f);continue}e=a[d],e!==f&&(a[d]=c[d])}},c.acceptState=function(a,c,d){var e=this.expression.call(d,a,c);b.merge(this.element,e),this.isMounted=!0},b}(d),j=function(a,b,c,d){var e={};return e.Component=a,e._componentMap={},e.components=function(a){Object.assign(e._componentMap,a)},e.processElement=function(a,f){var g,h,i=a.getAttribute("data-if"),j=a.getAttribute("data-out"),k=a.getAttribute("data-component"),l=a.getAttribute("data-each");if(null!==i&&(g=new b(a),g.expression=e.compileExpression(i),h=a.getAttribute("data-animate"),null!==h&&(g.animator.prefix=h,g.animator.enable()),f.addToTree(g)),null!==j&&(g=new d(a),g.expression=e.compileExpression(j),f.addToTree(g)),null!==k){var m=e._componentMap[k];g=new m(a),g.expression=e.compileExpression(a.getAttribute("data-state")),f.addToTree(g)}null!==l&&(g=new c(a),g.expression=e.compileExpression(l),g.keyExpression=e.compileExpression(a.getAttribute("data-key")||e.defaultKeyExpression),h=a.getAttribute("data-animate-each"),null!==h&&(g.animator.prefix=h,g.animator.enable()),f.addToTree(g))},e.mount=function(a,b,c){var d,f,g=new b(a),h=a.querySelectorAll("[data-if], [data-out], [data-component], [data-each]");for(d=0,f=h.length;f>d;d++)e.processElement(h[d],g);return g.controlDidParse(),g.acceptState(c),g},e.compileExpression=function(a){return new Function("state, loop","return "+a+";")},e.defaultKeyExpression="loop.key",e}(e,f,h,i)});