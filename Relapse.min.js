!function(){var a,b,c,d,e,f,g;a=function(a){function b(a,b){this.element=a,this.expression=b,this.children=[],this.id=c++}var c=1;return b.prototype.acceptState=function(a,b){var c,d;for(c=0,d=this.children.length;d>c;c++)this.children[c].acceptState(a,b)},b.prototype.moldify=function(a){this.element.setAttribute("data-control-"+a+"-"+this.id,"")},b.prototype.cloneOn=function(a){var b,c=this.constructor,d=new c;for(b in d)d.hasOwnProperty(b)&&("iterations"===b?d.iterations={}:d[b]=this[b]);return d.element=a,d},b}({}),b=function(a){function b(a,b){c.call(this,a,b),this.state=Object.assign({},this.constructor.defaults)}var c=c;return b.prototype=Object.create(c.prototype),b.prototype.constructor=b,b.defaults={},b.prototype.acceptState=function(a,b){this.setState(this.expression(a,b),b)},b.prototype.setState=function(a,b){Object.assign(this.state,a),this.children.forEach(function(a){a.acceptState(this.state,b)},this)},b}({}),c=function(a){function b(a,d){c.call(this,a,d),this.parentNode=a.parentNode,this.nextSiblings=b.getNextSiblings(a)}var c=c;return b.prototype=Object.create(c.prototype),b.prototype.constructor=b,b.getNextSiblings=function(a){for(var b=a,c=[];null!==(b=b.nextSibling);)c.push(b);return c},b.prototype.acceptState=function(a,b){this.expression(a,b)?(this.attach(),c.prototype.acceptState.call(this,a,b)):this.detach()},b.prototype.attach=function(){for(var a,b=-1;void 0!==(a=this.nextSiblings[++b]);)if(a.parentNode===this.parentNode)return void this.parentNode.insertBefore(this.element,a);this.parentNode.appendChild(this.element)},b.prototype.detach=function(){this.element.parentNode===this.parentNode&&this.parentNode.removeChild(this.element)},b}({}),d=function(a){function b(a,b){c.call(this,a,b),this.childNodes=Array.prototype.slice.call(a.childNodes,0)}var c=c;return b.prototype=Object.create(c.prototype),b.prototype.constructor=b,b.from=function(a){var c=new b(a.template.cloneNode(!0));return b.copyChildren(c,a),c},b.copyChildren=function(a,c){a.children=c.children.map(function(d){var e="[data-control-"+c.id+"-"+d.id+"]",f=d.cloneOn(a.element.querySelector(e));return b.copyChildren(f,d),f})},b}({}),e=function(a){function b(a,b,d){c.call(this,a,b),this.keyExpression=d,this.template=document.createElement("template"),this.iterations={}}var c=c,d=d;return b.prototype=Object.create(c.prototype),b.prototype.constructor=b,b.prototype.acceptState=function(a,b){var c=this.expression(a,b);b={key:null,val:null,outer:b};var e=document.createDocumentFragment();c.forEach(function(c,f){b.key=f,b.val=c;var g=this.keyExpression(a,b),h=this.iterations[g];void 0===h&&(h=d.from(this),this.iterations[g]=h),h.acceptState(a,b),h.childNodes.forEach(function(a){e.appendChild(a)})},this),this.element.innerHTML="",this.element.appendChild(e)},b}({}),f=function(a){function b(a,b){c.call(this,a,b)}var c=c;return b.prototype=Object.create(c.prototype),b.prototype.constructor=b,b.merge=function(a,c){var d,e,f;for(d in c)if(c.hasOwnProperty(d)){if(f=c[d],"object"==typeof f){b.merge(a[d],f);continue}e=a[d],e!==f&&(a[d]=c[d])}},b.prototype.acceptState=function(a,c){var d=this.expression(a,c);b.merge(this.element,d)},b}({}),g=function(a){var b=b,c=c,d=d,e=e,f={};return f.componentMap={},f.mount=function(a,g,h){var i=new g(a),j=[i],k=[],l=function(a){var c,d,f=a.element,g=j.length;for(a.constructor!==e&&j.push(a),d=g;--d>=0;)if(c=j[d],c instanceof b){a.expression=a.expression.bind(c);break}for(d=g;--d>=0;)if(c=j[d],c.element.contains(f)||c.element===f){c.children.push(a),a.moldify(c.id);break}},m=a.querySelectorAll("[data-if], [data-out], [data-component], [data-each]");return Array.prototype.forEach.call(m,function(a,b){var g,h=a.dataset.out,i=a.dataset["if"],j=a.dataset.component,m=a.dataset.each;if(void 0!==i&&(g=f.compileExpression(i),l(new c(a,g))),void 0!==h&&(g=f.compileExpression(h),l(new e(a,g))),void 0!==j){var n=f.componentMap[j];g=f.compileExpression(a.dataset.state),l(new n(a,g))}if(void 0!==m){var o,p=f.compileExpression(a.dataset.key);g=f.compileExpression(m),o=new d(a,g,p),l(o),k.push(o)}}),k.forEach(function(a){Array.prototype.forEach.call(a.element.children,function(b){a.template.appendChild(b)})}),i.setState(h),i},f.compileExpression=function(a){return new Function("state, loop","return "+a+";")},f}({})}();